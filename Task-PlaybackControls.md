# Context
Filename: Task-PlaybackControls.md
Created On: 2025-12-20 16:33:18 CST
Created By: AI
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
修复播放底栏在宽度变小时爱心/歌词/播放列表区域换行的问题；允许控制中间区域宽度，但不隐藏任何组件。新增：退出登录时停止音频播放并清空播放队列/进度。

# Project Overview
前端播放器组件（Vue + TailwindCSS），文件路径 `src/components/player/PlaybackControls.vue`，负责底部播放控制栏的布局和交互。

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
底栏使用网格：基础两列（左信息 + 右控制跨两列），在 sm 变两列、lg 变三列。右侧心形/歌词/播放列表位于第二列，空间不足时换行；中间控制区存在 `flex-wrap`，但主要是网格列宽压缩导致换行。

# Proposed Solution (Populated by INNOVATE mode)
不隐藏组件，通过调整网格列宽：在 sm 起改为三列，左右自适应，中间列限定 min/max 宽度；右侧独立列不被挤压。中间控制区增加宽度约束，避免过宽撑开网格。登出时通过播放器组合式函数提供 stop，播放器 store 提供 resetPlayerState，auth 登出调用两者以停止并清空播放状态。

# Implementation Plan (Generated by PLAN mode)
调整网格列定义与中间控制区宽度，保证三块同排，防止右侧换行。

Implementation Checklist:
1. 更新 `src/components/player/PlaybackControls.vue` 顶层 grid 类：在 sm 断点改为 3 列布局（左右列自适应，中间列设定 min/max 宽度），lg 断点保持上限，避免右侧收藏/歌词/播放列表换行。
2. 为中间控制区容器补充宽度限制/填充类（如 w-full + max-w），与新的列宽约束匹配，防止中间区域挤占左右列导致换行。
3. 在播放器层实现停止/重置能力（暂停音频、重置进度），暴露可供外部调用的方法。
4. 在播放器 store 添加清空队列/进度的 action，并移除本地持久化，保留音量等偏好。
5. 在 auth 登出流程中调用播放器停止+清空逻辑，确保退出后音频停止且状态被清空。
6. 为底栏外层容器添加最大宽度与居中，并在 lg 断点网格列左右对称，保证 2k 屏下居中显示。
7. 在 Auth 页面增加炫酷特效（轻量 CSS 渐变 + Canvas 粒子），移动端亦启用，确保不影响交互并可清理。

# Current Execution Step (Updated by EXECUTE mode when starting a step)
> Currently executing: "None"

# Task Progress (Appended by EXECUTE mode after each step completion)
* 2025-12-20 16:33:18 CST
    * Step: 1. 更新 `src/components/player/PlaybackControls.vue` 顶层 grid 类：在 sm 断点改为 3 列布局（左右列自适应，中间列设定 min/max 宽度），lg 断点保持上限，避免右侧收藏/歌词/播放列表换行。
    * Modifications: 更新顶层容器网格类为 `sm:grid-cols-[minmax(0,1fr)_minmax(260px,420px)_max-content]` 与 `lg:grid-cols-[minmax(0,1.2fr)_minmax(320px,520px)_max-content]`，为右侧提供独立列，中间列限定宽度。
    * Change Summary: 调整 sm+/lg 网格列定义为三列，限制中间列宽度。
    * Reason: Executing plan step 1
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 16:33:18 CST
    * Step: 2. 为中间控制区容器补充宽度限制/填充类（如 w-full + max-w），与新的列宽约束匹配，防止中间区域挤占左右列导致换行。
    * Modifications: 为中间控制区容器新增 `w-full max-w-[520px]` 以匹配列的最大宽度，避免撑开网格。
    * Change Summary: 中间控制区宽度约束，保持与列定义一致。
    * Reason: Executing plan step 2
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 16:33:18 CST
    * Step: 3. 在播放器层实现停止/重置能力（暂停音频、重置进度），暴露可供外部调用的方法。
    * Modifications: `src/composables/usePlayer.ts` 新增 `stop()`，暂停音频、归零进度并更新播放状态。
    * Change Summary: 提供外部可调用的停止方法。
    * Reason: Executing plan step 3
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 16:33:18 CST
    * Step: 4. 在播放器 store 添加清空队列/进度的 action，并移除本地持久化，保留音量等偏好。
    * Modifications: `src/store/player.ts` 新增 `resetPlayerState`，清空队列/进度/歌词，移除本地存储，保留音量与播放模式字段。
    * Change Summary: 提供重置播放状态的 store 方法。
    * Reason: Executing plan step 4
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 16:33:18 CST
    * Step: 5. 在 auth 登出流程中调用播放器停止+清空逻辑，确保退出后音频停止且状态被清空。
    * Modifications: `src/store/auth.ts` 的 `logout` 调用 `usePlayer().stop()` 与 `playerStore.resetPlayerState()`，在注销成功后停止播放并清空播放状态。
    * Change Summary: 登出时同步停止音频并清空队列/进度。
    * Reason: Executing plan step 5
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 16:33:18 CST
    * Step: 6. 为底栏外层容器添加最大宽度与居中，并在 lg 断点网格列左右对称，保证 2k 屏下居中显示。
    * Modifications: `src/components/player/PlaybackControls.vue` 外层 grid 添加 `max-w-screen-xl mx-auto`，lg 列改为 `minmax(0,1fr)_minmax(320px,520px)_minmax(0,1fr)`，左右对称居中。
    * Change Summary: 大屏下底栏居中显示，避免偏右。
    * Reason: Executing plan step 6
    * Blockers: None
    * User Confirmation Status: Pending Confirmation
* 2025-12-20 17:23:53 CST
    * Step: 7. 在 Auth 页面增加炫酷特效（轻量 CSS 渐变 + Canvas 粒子），移动端亦启用，确保不影响交互并可清理。
    * Modifications: `src/views/AuthView.vue` 添加背景渐变层与动画（`animate-gradient-slow`）、Canvas 粒子效果（初始化/清理、限定粒子数量与速度），父容器 `overflow-hidden` 与 `pointer-events-none` 保证交互不受阻。
    * Change Summary: Auth 页全屏炫彩渐变 + 粒子漂浮特效，移动端可见且性能受控。
    * Reason: Executing plan step 7
    * Blockers: None
    * User Confirmation Status: Pending Confirmation

# Final Review (Populated by REVIEW mode)
Pending
